<br />

<dx-button
  type="default"
  (onClick)="showPopupEditIntervention($event)"
  icon="/assets/icons/intervention.png"
  text="Editer mes interventions"
  style="margin-right: 10px; margin-left: 10px"
></dx-button>

<dx-button
  type="default"
  (onClick)="showPopupEditInterventionall($event)"
  icon="/assets/icons/intervention.png"
  text="Editer les interventions"
  style="margin-right: 10px; margin-left: 10px"
  *ngIf="interventionbool"
></dx-button>

<dx-button
  type="default"
  (onClick)="showPopupIntervention($event)"
  icon="/assets/icons/intervention.png"
  text="Intervention & Prestation médicale"
  *ngIf="interventionbool"
  style="margin-right: 10px; margin-left: 10px"
></dx-button>

<br />
<br />

<dx-popup
  [width]="'80%'"
  [height]="'80%'"
  [hideOnOutsideClick]="true"
  [showCloseButton]="true"
  [(visible)]="popupVisibleEditIntervention"
  title="Editer mes interventions"
>
<h2>Edition des interventions</h2>

<dx-data-grid
  id="gridContainer"
  [dataSource]="interventionfiltrermapday"
  keyExpr="id_intervention"
  [showBorders]="true"
  (onRowUpdating)="onRowUpdating($event)">

  <dxo-editing
  mode="popup"
  [allowUpdating]="true"
  [texts]="{ saveRowChanges: 'Enregistrer', cancelRowChanges: 'Annuler' }">
  <dx-popup
      [width]="'80%'"
      [height]="'80%'"
      [hideOnOutsideClick]="true"
      [showCloseButton]="true"
      [showTitle]="true"
  >
  </dx-popup>
</dxo-editing>

</dx-data-grid>

</dx-popup>

<dx-popup
  [width]="'80%'"
  [height]="'80%'"
  [hideOnOutsideClick]="true"
  [showCloseButton]="true"
  [(visible)]="popupVisibleEditInterventionAll"
  title="Editer les interventions"
>
<h2>Edition des interventions</h2>

<dx-data-grid
  id="gridContainer"
  [dataSource]="agendasPrevisionnels2"
  keyExpr="id_intervention"
  [showBorders]="true"
  (onRowUpdating)="onRowUpdating2($event)">

  <dxo-editing
  mode="popup"
  [allowUpdating]="true"
  [texts]="{ saveRowChanges: 'Enregistrer', cancelRowChanges: 'Annuler' }">
  <dx-popup
      [width]="'80%'"
      [height]="'80%'"
      [hideOnOutsideClick]="true"
      [showCloseButton]="true"
      [showTitle]="true"
  >
  </dx-popup>
</dxo-editing>

</dx-data-grid>

</dx-popup>

<dx-popup
  [width]="'80%'"
  [height]="'80%'"
  [hideOnOutsideClick]="true"
  [showCloseButton]="true"
  [(visible)]="popupVisibleIntervention"
  title="Créer une nouvelle intervention"
>
  <div *dxTemplate="let data of 'content'">
    <dx-form [formData]="interventionForm">
      <dxi-item itemType="group" cssClass="form-group" [colCount]="2">
        <dxi-item
          dataField="text"
          editorType="dxTextBox"
          [editorOptions]="{
            placeholder:'Intitulé de lintervention',
          }"
        ></dxi-item>

        <dxi-item
          dataField="startDate"
          editorType="dxDateBox"
          [editorOptions]="{
            placeholder:'Début de lintervention',
            width: '100%',
            type: 'datetime',
            displayFormat: 'yyyy-MM-dd HH:mm',
          }"
        ></dxi-item>

        <dxi-item
          dataField="endDate"
          editorType="dxDateBox"
          [editorOptions]="{
            placeholder:'Fin de lintervention',
            width: '100%',
            type: 'datetime',
            displayFormat: 'yyyy-MM-dd HH:mm',
          }"
        ></dxi-item>

        <dxi-item
          dataField="id_patient"
          editorType="dxSelectBox"
          [editorOptions]="{
          dataSource: patients,
          valueExpr: 'id_patient',
          displayExpr: 'nomPrenom',
          placeholder: 'Sélectionner un patient',
          width: '100%',
          searchEnabled: true,
        }"
        ></dxi-item>

        <dxi-item
        dataField="id_personnel"
        editorType="dxSelectBox"
        [editorOptions]="{
      dataSource: soignants,
      valueExpr: 'id_personnel',
      displayExpr: 'nomPrenom',
      placeholder: 'Sélectionner un soignant',
      width: '100%',
      searchEnabled: true,
    }"
      ></dxi-item>

        <dxi-item
        dataField="id_prestations"
        editorType="dxTagBox"
        [editorOptions]="{
          dataSource: prestationsall,
          valueExpr: 'id_prestation',
          displayExpr: 'libelle_prestation',
          placeholder: 'Sélectionner des prestations',
          width: '100%',
          searchEnabled: true,
          showSelectionControls: true,
          multiline: true,
        }"
      ></dxi-item>
      
      
      
      </dxi-item>
    </dx-form>

    <div style="text-align: center; margin-top: 20px">
      <dx-button icon="floppy" (click)="onSubmit($event)"></dx-button>
    </div>
  </div>
</dx-popup>

<dx-scheduler
  *ngIf="interventionbool"
  timeZone="Europe/Paris"
  [dataSource]="agendasPrevisionnels2"
  [views]="['day', 'week', 'workWeek', 'month']"
  currentView="day"
  [currentDate]="currentDate"
  [startDayHour]="9"
  [height]="730"
  (onAppointmentFormOpening)="onAppointmentFormOpening($event)"
  (onAppointmentDeleted)="onAppointmentDeleted($event)"
  (onAppointmentFormHiding)="onDeleteButtonClick($event)"
>
<dxo-editing [allowUpdating]="true"></dxo-editing>
</dx-scheduler>


<dx-scheduler
  *ngIf="!interventionbool"
  timeZone="Europe/Paris"
  [dataSource]="interventionfiltrermap"
  [views]="['day', 'week', 'workWeek', 'month']"
  currentView="day"
  [currentDate]="currentDate"
  [startDayHour]="9"
  [height]="730"
  (onAppointmentFormOpening)="onAppointmentFormOpening($event)"
>
  <dxo-editing [allowUpdating]="true"></dxo-editing>
</dx-scheduler>


<br/>

<dx-button
  type="default"
  (onClick)="CalculItineraire($event)"
  icon="/assets/icons/loc.png"
  text="Itinéraire d'aujourd'hui"
  (onClick)="showPopupItineraire($event)"
  style="margin-right: 10px; margin-left: 10px"
></dx-button>

<dx-popup
  [width]="'80%'"
  [height]="'80%'"
  [hideOnOutsideClick]="true"
  [showCloseButton]="true"
  [(visible)]="popupVisibleitineraire"
  title="Carte des interventions"
>
  <dx-map
    provider="google"
    [apiKey]="'AIzaSyC6aoXl4XsKf8pHYAXD-SGcxZVO0D7R33c'"
    [zoom]="14"
    [height]="440"
    width="100%"
    [controls]="true"
    [markers]="markers"
    [routes]="[route]"
    routeColorField="color"
    routeModeField="mode"
  >
  </dx-map>
  <br />

  <dx-data-grid
    id="gridContainer"
    [dataSource]="itinerairemap"
    [showBorders]="true"
  >
  </dx-data-grid>
</dx-popup>

<br />
